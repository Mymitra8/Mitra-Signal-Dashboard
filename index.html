<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mitra Signal Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #0d1117;
    color: #c9d1d9;
    margin: 0;
    padding: 0;
  }
  header {
    padding: 20px;
    background-color: #161b22;
    text-align: center;
    font-size: 24px;
    font-weight: bold;
  }
  main {
    padding: 20px;
  }
  .card {
    background-color: #161b22;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  .card h2 {
    margin-top: 0;
    font-size: 18px;
  }
  select, button {
    padding: 8px;
    margin: 5px;
    border: none;
    border-radius: 5px;
    font-size: 14px;
  }
  select {
    background-color: #21262d;
    color: #c9d1d9;
  }
  button {
    background-color: #238636;
    color: white;
    cursor: pointer;
  }
  button.stop {
    background-color: #da3633;
  }
  button:hover {
    opacity: 0.9;
  }
  .status {
    font-size: 14px;
    margin-top: 10px;
  }
  .status span {
    font-weight: bold;
  }
</style>
</head>
<body>

<header>Mitra Signal Dashboard</header>

<main>
  <div class="card">
    <h2>Engine Control</h2>
    <label for="strategy">Select Strategy:</label>
    <select id="strategy">
      <option value="Ganu">Ganu</option>
      <option value="Enhanced">Enhanced</option>
      <option value="Scalping">Scalping</option>
    </select>
    <br>
    <button onclick="startEngine()">Start Engine</button>
    <button class="stop" onclick="stopEngine()">Stop Engine</button>
    <button onclick="manualScan()">Run Manual Scan</button>
    <button onclick="sendTestMessage()">Send Telegram Test</button>
    <div class="status" id="statusBox">Loading status...</div>
  </div>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwBXjQ0IlDtzgFah5KxPr2zdeQLD-WdJT-6YEdiFMX3wnw-ciET2wo2XCqyquVRQ9w5/exec";

async function getStatus() {
  try {
    const res = await fetch(`${API_URL}?action=getStatus`);
    const data = await res.json();
    document.getElementById('statusBox').innerHTML =
      `Engine: <span>${data.isRunning ? 'Running' : 'Stopped'}</span><br>
      Strategy: <span>${data.activeStrategy}</span><br>
      Telegram Configured: <span>${data.telegramConfigured ? 'Yes ✅' : 'No ❌'}</span><br>
      Alerts Today: <span>${data.todayAlerts}/${data.alertLimit}</span>`;
  } catch (err) {
    document.getElementById('statusBox').innerText = "Error fetching status";
  }
}

async function startEngine() {
  const strategy = document.getElementById('strategy').value;
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "startEngine", strategy }),
    headers: { "Content-Type": "application/json" }
  });
  getStatus();
}

async function stopEngine() {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "stopEngine" }),
    headers: { "Content-Type": "application/json" }
  });
  getStatus();
}

async function manualScan() {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "manualScan" }),
    headers: { "Content-Type": "application/json" }
  });
  alert("Manual scan triggered (check logs & sheet)");
}

async function sendTestMessage() {
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "sendTestMessage" }),
    headers: { "Content-Type": "application/json" }
  });
  alert("Test message sent to Telegram");
}

// Auto-refresh every 30s
getStatus();
setInterval(getStatus, 30000);
</script>

</body>
</html>
